# Document Service

Backend-сервис для управления документами с поддержкой статусов, истории изменений и реестра утверждений.

##  Требования

- Java 17+
- Docker & Docker Compose
- Maven
- PostgreSQL (через Docker)

##  Запуск сервиса

### 1. Запуск PostgreSQL через Docker

```bash
 
docker-compose up -d 
```
### 2. Сборка и запуск приложения 
``` bash

mvn clean package

java -jar target/document-service-0.0.1-SNAPSHOT.jar
```

После запуска приложения начнется работа двух фоновых сервисов (ApproveWorker и SubmitWorker).
Параллельно с этим запустится утильный класс, генерирующий документы. Все параметры для работы этих сервисов указаны в application.yml.
Схема базы данных поднимается с помощью Liquibase, в настройках для него указаны preConditions.

В логах будет отображение согласования и утверждения пачек документов, а также  их создание. Все это будет сопровождаться также логированием временных промежутков между началом отправки, обработкой и, соответственно, получение ответа и окончанием обработки.
### 3. Содержание API
##  Базовые операции с документами

| Метод | Endpoint | Описание                                                               | Заголовки |
|-------|----------|------------------------------------------------------------------------|-----------|
| **POST** | `/api/documents` | Создать новый документ в статусе DRAFT                                 | `X-Initiator` |
| **GET** | `/api/documents/{id}` | Получить документ по ID с историей                                     | - |
| **POST** | `/api/documents/batch` | Получить документы по списку ID                                        | - |

Эндпоинты для изменения статусов документов. Все запросы требуют заголовок `X-Initiator`.

| Метод | Endpoint | Описание | Заголовки |
|-------|----------|----------|-----------|
| **POST** | `/api/documents/submit` | Отправить документы на согласование (DRAFT → SUBMITTED) | `X-Initiator` |
| **POST** | `/api/documents/approve` | Утвердить документы (SUBMITTED → APPROVED) | `X-Initiator` |


Поиск и тестирование

| Метод | Endpoint | Описание | Параметры |
|-------|----------|----------|-----------|
| **GET** | `/api/documents/search` | Поиск документов по фильтрам | `status`, `author`, `dateFrom`, `dateTo`, `page`, `size`, `sort` |
| **POST** | `/api/documents/test/concurrent-approval` | Тест конкурентного утверждения | - |

---

### Поиск документов

Эндпоинт для поиска документов с фильтрацией по различным критериям. Поиск осуществляется по дате **создания** документа.

**Endpoint:** `GET /api/documents/search`

#### Параметры запроса

| Параметр | Тип | Обязательный | Описание | Пример |
|----------|-----|--------------|----------|--------|
| `status` | enum | нет | Фильтр по статусу документа | `DRAFT`, `SUBMITTED`, `APPROVED` |
| `author` | string | нет | Фильтр по автору документа | `Иван Петров` |
| `dateFrom` | datetime | нет | Начало периода (по дате создания) | `2026-02-01T00:00:00` |
| `dateTo` | datetime | нет | Конец периода (по дате создания) | `2026-02-28T23:59:59` |
| `page` | integer | нет | Номер страницы (по умолчанию `0`) | `0` |
| `size` | integer | нет | Размер страницы (по умолчанию `20`) | `20` |
| `sort` | string | нет | Сортировка (по умолчанию `createdAt,desc`) | `createdAt,desc` |